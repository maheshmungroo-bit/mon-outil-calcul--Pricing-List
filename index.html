<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur de Prix & Marges - AED</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .input-field {
            border-bottom: 1px solid #9ca3af;
            padding: 2px 4px;
            width: 100%;
            display: inline-block;
            text-align: right;
            background-color: #f0f9ff;
        }
        .calculated-field {
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 4px;
            width: 100%;
            display: inline-block;
            text-align: right;
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            border-bottom: 3px solid #1e293b;
            padding-bottom: 0.75rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            border: 1px solid #e2e8f0;
        }
        .tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 0.875rem;
        }
        .info-box {
            background-color: #f1f5f9;
            border-left: 4px solid #64748b;
            padding: 1rem;
            border-radius: 0px 8px 8px 0px;
            margin-bottom: 2rem;
        }
        #notification {
            transition: opacity 0.5s ease-in-out;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
        .modal-container {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 1024px;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Print Styles */
        @media print {
            .no-print { display: none !important; }
            body * {
                visibility: hidden;
            }
            #price-list-printable, #price-list-printable * {
                visibility: visible;
            }
            #price-list-printable {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .modal-container {
                box-shadow: none;
                border: none;
                max-height: none;
                overflow-y: visible;
            }
        }
    </style>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body onload="initCalculator()">

    <script>
        // --- VOTRE CONFIGURATION FIREBASE ---
        const firebaseConfig = {
          apiKey: "AIzaSyA3FyL-6WQy7GhgogO_A20h5-Qo0kFgpS0",
          authDomain: "pricing-5fab2.firebaseapp.com",
          projectId: "pricing-5fab2",
          storageBucket: "pricing-5fab2.appspot.com",
          messagingSenderId: "584666625551",
          appId: "1:584666625551:web:6cfdf06bd4e643e426557a"
        };

        // --- INITIALISATION DE FIREBASE ---
        let db;
        let isFirebaseConfigured = false;
        if (firebaseConfig.projectId && firebaseConfig.projectId !== "VOTRE_PROJET_ID") {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            isFirebaseConfigured = true;
        }
    </script>

    <div class="max-w-7xl mx-auto p-4 sm:p-8">

        <!-- Bannière d'alerte Firebase -->
        <div id="firebase-warning" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4 m-8 mb-8" role="alert">
            <p class="font-bold">Configuration requise</p>
            <p>Votre projet Firebase n'est pas encore configuré. Veuillez copier votre `firebaseConfig` depuis la console Firebase dans le fichier HTML pour activer la sauvegarde en ligne.</p>
        </div>

        <!-- Header -->
        <div class="flex flex-wrap justify-between items-center mb-8 gap-4">
            <div>
                <h1 class="text-4xl font-bold text-gray-800">Calculateur Stratégique de Prix</h1>
            </div>
            <div class="flex items-center gap-4">
                 <button onclick="openPriceListModal()" class="no-print bg-green-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-green-500 transition duration-300 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                    Générer Liste de Prix
                </button>
                <button onclick="saveData()" class="no-print bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-blue-500 transition duration-300 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                    Sauvegarder
                </button>
                <button onclick="window.print()" class="no-print bg-slate-800 text-white font-semibold py-2 px-5 rounded-lg hover:bg-slate-700 transition duration-300 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9V2h12v7"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><path d="M6 14h12v8H6z"/></svg>
                    Imprimer / PDF
                </button>
                <span id="notification" class="text-green-600 font-semibold opacity-0"></span>
            </div>
        </div>
        
        <!-- === CALCULATEUR DE CHANGE === -->
        <div class="card mb-8 bg-slate-900 text-white">
            <h2 class="section-title !text-white !border-b-slate-500">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 12H4"/><path d="m6 16 4-4-4-4"/><path d="m18 8-4 4 4 4"/></svg>
                Calculateur de Change
                <span id="exchange-rate-status" class="text-xs font-normal ml-4"></span>
                <button onclick="fetchExchangeRates()" class="no-print ml-auto w-8 h-8 flex items-center justify-center rounded bg-slate-700 hover:bg-slate-600 transition-colors" title="Mettre à jour les taux">
                    <svg class="w-5 h-5 text-slate-300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/></svg>
                </button>
                <button onclick="saveData()" class="no-print ml-2 w-8 h-8 flex items-center justify-center rounded bg-slate-700 hover:bg-slate-600 transition-colors" title="Sauvegarder les données">
                    <svg class="w-5 h-5 text-slate-300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                </button>
            </h2>
            <div class="grid md:grid-cols-2 gap-8 mb-4">
                <div>
                    <label class="font-semibold text-gray-300">Taux de Change (modifiable)</label>
                    <div class="flex items-center gap-4 mt-2">
                       <span class="text-gray-300">1 USD = <input id="rate_usd_aed" type="number" value="3.67" step="0.001" class="w-24 p-1 border rounded-md text-center text-gray-900" onkeyup="calculateAll()"> AED</span>
                       <span class="text-gray-300">1 EUR = <input id="rate_eur_aed" type="number" value="3.95" step="0.001" class="w-24 p-1 border rounded-md text-center text-gray-900" onkeyup="calculateAll()"> AED</span>
                    </div>
                </div>
                <div>
                    <label class="font-semibold text-gray-300">Convertisseur Rapide</label>
                     <div class="flex items-center gap-4 mt-2">
                       <input id="conv_aed" type="number" placeholder="AED" class="w-full p-1 border rounded-md text-gray-900" onkeyup="convertCurrency('aed')">
                       <input id="conv_usd" type="number" placeholder="USD" class="w-full p-1 border rounded-md text-gray-900" onkeyup="convertCurrency('usd')">
                       <input id="conv_eur" type="number" placeholder="EUR" class="w-full p-1 border rounded-md text-gray-900" onkeyup="convertCurrency('eur')">
                    </div>
                </div>
            </div>
        </div>


        <!-- === PARTIE 1: SÉLECTION DE LA GAMME === -->
        <div class="card mb-8">
            <h2 class="section-title">
                 <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/><path d="M21 14H3"/><path d="M10 18H3"/></svg>
                Partie 1 : Sélection de la Gamme
                <button onclick="saveData()" class="no-print ml-auto w-8 h-8 flex items-center justify-center rounded bg-slate-100 hover:bg-slate-200 transition-colors" title="Sauvegarder les données">
                    <svg class="w-5 h-5 text-slate-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                </button>
            </h2>
            <div class="grid md:grid-cols-1 gap-8">
                <div>
                    <label for="product_range" class="block text-lg font-semibold text-gray-700">Gamme de Produit</label>
                    <p class="text-sm text-gray-500 mb-2">Sélectionnez la gamme pour afficher et modifier ses coûts ci-dessous.</p>
                    <select id="product_range" class="w-full p-2 border border-gray-300 rounded-md bg-white" onchange="updateDirectCosts()">
                        <!-- Options will be populated by script -->
                    </select>
                </div>
            </div>
        </div>

        <!-- === PARTIE 2: COÛT DE REVIENT PAR PIÈCE === -->
        <div class="card mb-8">
            <h2 class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2z"/><path d="M8 12h8"/><path d="M12 16V8"/></svg>
                Partie 2 : Coût de Revient par Pièce
                <button onclick="saveData()" class="no-print ml-auto w-8 h-8 flex items-center justify-center rounded bg-slate-100 hover:bg-slate-200 transition-colors" title="Sauvegarder les données">
                    <svg class="w-5 h-5 text-slate-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                </button>
            </h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-6">
                <!-- Coûts Directs -->
                <div>
                    <h3 class="font-bold text-lg mb-2 text-gray-700">A. Coûts Directs de Production (par pièce)</h3>
                    <div class="grid grid-cols-2 gap-4 text-right pr-1 mb-1 text-sm font-semibold text-gray-500">
                        <span></span>
                        <div class="grid grid-cols-3 gap-2">
                            <span>AED (Base)</span>
                            <span>USD</span>
                            <span>EUR</span>
                        </div>
                    </div>
                    <ul class="space-y-3 text-sm text-gray-800 bg-slate-50 p-4 rounded-md">
                        <li class="grid grid-cols-2 gap-4 items-center">
                            <span>Matières Premières</span>
                            <div class="grid grid-cols-3 gap-2">
                                <span id="cost_matieres" contenteditable="true" class="input-field" onkeyup="updateAndCalculate('matieres')">...</span>
                                <span id="cost_matieres_usd" class="calculated-field bg-gray-100 text-sm">...</span>
                                <span id="cost_matieres_eur" class="calculated-field bg-gray-100 text-sm">...</span>
                            </div>
                        </li>
                        <li class="grid grid-cols-2 gap-4 items-center">
                            <span>Main d'œuvre Couturier</span>
                             <div class="grid grid-cols-3 gap-2">
                                <span id="cost_couturier" contenteditable="true" class="input-field" onkeyup="updateAndCalculate('couturier')">...</span>
                                <span id="cost_couturier_usd" class="calculated-field bg-gray-100 text-sm">...</span>
                                <span id="cost_couturier_eur" class="calculated-field bg-gray-100 text-sm">...</span>
                            </div>
                        </li>
                        
                        <li class="grid grid-cols-2 gap-4 items-start border-t pt-3">
                            <span>Main d'œuvre Artiste</span>
                            <div class="space-y-2">
                                <div class="grid grid-cols-2 gap-2 text-xs items-center">
                                    <label for="cost_artiste_heures" class="text-gray-600 text-left">Nombre d'heures</label>
                                    <input type="number" id="cost_artiste_heures" class="p-1 border rounded-md text-right bg-sky-50" onkeyup="updateAndCalculateArtistCost()">
                                </div>
                                <div class="grid grid-cols-2 gap-2 text-xs items-center">
                                     <label for="cost_artiste_taux" class="text-gray-600 text-left">Taux horaire (AED)</label>
                                    <input type="number" id="cost_artiste_taux" class="p-1 border rounded-md text-right bg-sky-50" onkeyup="updateAndCalculateArtistCost()">
                                </div>
                                <div class="grid grid-cols-3 gap-2 mt-1">
                                    <strong id="cost_artiste" class="calculated-field bg-sky-100 text-sky-800">...</strong>
                                    <strong id="cost_artiste_usd" class="calculated-field bg-gray-100 text-sm">...</strong>
                                    <strong id="cost_artiste_eur" class="calculated-field bg-gray-100 text-sm">...</strong>
                                </div>
                            </div>
                        </li>

                        <li class="grid grid-cols-2 gap-4 items-center border-t pt-3">
                            <span>Packaging de Luxe</span>
                            <div class="grid grid-cols-3 gap-2">
                                <span id="cost_packaging" contenteditable="true" class="input-field" onkeyup="updateAndCalculate('packaging')">...</span>
                                <span id="cost_packaging_usd" class="calculated-field bg-gray-100 text-sm">...</span>
                                <span id="cost_packaging_eur" class="calculated-field bg-gray-100 text-sm">...</span>
                            </div>
                        </li>
                        <li class="grid grid-cols-2 gap-4 items-center mt-4 border-t pt-3">
                            <strong class="text-base text-left">TOTAL DIRECTS (A)</strong>
                            <div class="grid grid-cols-3 gap-2">
                                <strong id="total_directs" class="calculated-field bg-green-100 text-green-800">...</strong>
                                <strong id="total_directs_usd" class="calculated-field bg-green-100 text-green-800 text-sm">...</strong>
                                <strong id="total_directs_eur" class="calculated-field bg-green-100 text-green-800 text-sm">...</strong>
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- Coûts Indirects -->
                <div>
                    <h3 class="font-bold text-lg mb-2 text-gray-700">B. Coûts Indirects & de Structure (annuels)</h3>
                    <div class="grid grid-cols-2 gap-4 text-right pr-1 mb-1 text-sm font-semibold text-gray-500">
                        <span></span>
                        <div class="grid grid-cols-3 gap-2">
                            <span>AED (Base)</span>
                            <span>USD</span>
                            <span>EUR</span>
                        </div>
                    </div>
                    <ul class="space-y-3 text-sm text-gray-800 bg-slate-50 p-4 rounded-md">
                         <li class="grid grid-cols-2 gap-4 items-center"><span>Atelier/Loyer</span><div class="grid grid-cols-3 gap-2"><span id="cost_atelier" contenteditable="true" class="input-field" onkeyup="calculateAll()">44040</span><span id="cost_atelier_usd" class="calculated-field bg-gray-100 text-sm">...</span><span id="cost_atelier_eur" class="calculated-field bg-gray-100 text-sm">...</span></div></li>
                        <li class="grid grid-cols-2 gap-4 items-center"><span>Amortissement Matériel</span><div class="grid grid-cols-3 gap-2"><span id="cost_amort" contenteditable="true" class="input-field" onkeyup="calculateAll()">11010</span><span id="cost_amort_usd" class="calculated-field bg-gray-100 text-sm">...</span><span id="cost_amort_eur" class="calculated-field bg-gray-100 text-sm">...</span></div></li>
                        <li class="grid grid-cols-2 gap-4 items-center"><span>Salaires Admin/Vente</span><div class="grid grid-cols-3 gap-2"><span id="cost_salaires" contenteditable="true" class="input-field" onkeyup="calculateAll()">183500</span><span id="cost_salaires_usd" class="calculated-field bg-gray-100 text-sm">...</span><span id="cost_salaires_eur" class="calculated-field bg-gray-100 text-sm">...</span></div></li>
                        <li class="grid grid-cols-2 gap-4 items-center"><span>Marketing & Shooting</span><div class="grid grid-cols-3 gap-2"><span id="cost_marketing" contenteditable="true" class="input-field" onkeyup="calculateAll()">55050</span><span id="cost_marketing_usd" class="calculated-field bg-gray-100 text-sm">...</span><span id="cost_marketing_eur" class="calculated-field bg-gray-100 text-sm">...</span></div></li>
                        <li class="grid grid-cols-2 gap-4 items-center"><span>Sites E-commerce & Email</span><div class="grid grid-cols-3 gap-2"><span id="cost_ecommerce" contenteditable="true" class="input-field" onkeyup="calculateAll()">2816</span><span id="cost_ecommerce_usd" class="calculated-field bg-gray-100 text-sm">...</span><span id="cost_ecommerce_eur" class="calculated-field bg-gray-100 text-sm">...</span></div></li>
                        <li class="grid grid-cols-2 gap-4 items-center"><span>Nom de domaine</span><div class="grid grid-cols-3 gap-2"><span id="cost_domain" contenteditable="true" class="input-field" onkeyup="calculateAll()">1195</span><span id="cost_domain_usd" class="calculated-field bg-gray-100 text-sm">...</span><span id="cost_domain_eur" class="calculated-field bg-gray-100 text-sm">...</span></div></li>
                        <li class="grid grid-cols-2 gap-4 items-center"><span>Licence & Visa</span><div class="grid grid-cols-3 gap-2"><span id="cost_license_visa" contenteditable="true" class="input-field" onkeyup="calculateAll()">9000</span><span id="cost_license_visa_usd" class="calculated-field bg-gray-100 text-sm">...</span><span id="cost_license_visa_eur" class="calculated-field bg-gray-100 text-sm">...</span></div></li>
                        <li class="grid grid-cols-2 gap-4 items-center"><span>Frais (Bancaires, etc.)</span><div class="grid grid-cols-3 gap-2"><span id="cost_frais" contenteditable="true" class="input-field" onkeyup="calculateAll()">9175</span><span id="cost_frais_usd" class="calculated-field bg-gray-100 text-sm">...</span><span id="cost_frais_eur" class="calculated-field bg-gray-100 text-sm">...</span></div></li>

                        <li class="grid grid-cols-2 gap-4 items-center mt-4 border-t pt-3">
                            <strong class="text-base text-left">TOTAL ANNUELS (B)</strong>
                             <div class="grid grid-cols-3 gap-2">
                                <strong id="total_annual" class="calculated-field bg-blue-100 text-blue-800">...</strong>
                                <strong id="total_annual_usd" class="calculated-field bg-blue-100 text-blue-800 text-sm">...</strong>
                                <strong id="total_annual_eur" class="calculated-field bg-blue-100 text-blue-800 text-sm">...</strong>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="text-center bg-slate-700 p-4 rounded-lg text-white mb-8 grid grid-cols-1 md:grid-cols-4 items-center">
                <span class="text-lg font-bold md:col-span-2">COÛT INDIRECT PAR PIÈCE (B / Unités produites) :</span>
                <span id="indirect_per_unit" class="text-xl font-bold">... AED</span>
                <div class="text-sm">
                    <p id="indirect_per_unit_usd">... USD</p>
                    <p id="indirect_per_unit_eur">... EUR</p>
                </div>
            </div>
             
             <div class="grid md:grid-cols-3 gap-8">
                <!-- SCENARIO EUROPE -->
                <div class="bg-blue-50 border border-blue-200 p-6 rounded-lg">
                    <h3 class="font-bold text-xl mb-4 text-blue-800 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20z"/><path d="M2 12h20"/></svg>
                        Scénario 1 : Vente en EUROPE
                    </h3>
                    <h4 class="font-semibold mb-2 text-gray-700">C. Coûts Logistiques (par pièce)</h4>
                     <div class="grid grid-cols-2 gap-4 text-right pr-1 mb-1 text-sm font-semibold text-gray-500">
                        <span></span>
                        <div class="grid grid-cols-3 gap-2">
                            <span>AED (Base)</span>
                            <span>USD</span>
                            <span>EUR</span>
                        </div>
                    </div>
                    <ul class="space-y-3 text-sm text-gray-800 mb-6">
                       <li class="grid grid-cols-2 gap-4 items-center"><span>Stockage France</span><div class="grid grid-cols-3 gap-2"><span id="cost_stock_fr" contenteditable="true" class="input-field" onkeyup="calculateAll()">55</span><span id="cost_stock_fr_usd" class="calculated-field bg-gray-100 text-sm">...</span><span id="cost_stock_fr_eur" class="calculated-field bg-gray-100 text-sm">...</span></div></li>
                       <li class="grid grid-cols-2 gap-4 items-center"><span>Expédition client Europe</span><div class="grid grid-cols-3 gap-2"><span id="cost_ship_eu" contenteditable="true" class="input-field" onkeyup="calculateAll()">92</span><span id="cost_ship_eu_usd" class="calculated-field bg-gray-100 text-sm">...</span><span id="cost_ship_eu_eur" class="calculated-field bg-gray-100 text-sm">...</span></div></li>
                    </ul>
                    <div class="bg-blue-200 p-4 rounded-lg text-center">
                        <p class="text-sm font-bold text-blue-900">PRIX DE REVIENT EUROPE</p>
                        <span id="final_cost_eu" class="text-3xl font-bold text-blue-900">...</span><span class="text-blue-900 font-semibold"> AED</span>
                        <div class="text-sm text-blue-800">
                            <p id="final_cost_eu_usd">... USD</p>
                            <p id="final_cost_eu_eur">... EUR</p>
                        </div>
                    </div>
                </div>

                <!-- SCENARIO EAU -->
                <div class="bg-green-50 border border-green-200 p-6 rounded-lg">
                    <h3 class="font-bold text-xl mb-4 text-green-800 flex items-center gap-2">
                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.54 2.25a.75.75 0 0 1 .46 1.34l-2.5 1.25a.75.75 0 0 0-.46 1.34l2.5 1.25a.75.75 0 0 1-.46 1.34l-10-5a.75.75 0 0 1 0-1.34l10-5Z"/><path d="M12.54 12.25a.75.75 0 0 1 .46 1.34l-2.5 1.25a.75.75 0 0 0-.46 1.34l2.5 1.25a.75.75 0 0 1-.46 1.34l-10-5a.75.75 0 0 1 0-1.34l10-5Z"/></svg>
                        Scénario 2 : Vente aux EAU
                    </h3>
                    <h4 class="font-semibold mb-2 text-gray-700">D. Coûts Logistiques (par pièce)</h4>
                     <div class="grid grid-cols-2 gap-4 text-right pr-1 mb-1 text-sm font-semibold text-gray-500">
                        <span></span>
                        <div class="grid grid-cols-3 gap-2">
                            <span>AED (Base)</span>
                            <span>USD</span>
                            <span>EUR</span>
                        </div>
                    </div>
                    <ul class="space-y-3 text-sm text-gray-800 mb-6">
                       <li class="grid grid-cols-2 gap-4 items-center"><span>Fret sécurisé FR -> EAU</span><div class="grid grid-cols-3 gap-2"><span id="cost_fret_uae" contenteditable="true" class="input-field" onkeyup="calculateAll()">110</span><span id="cost_fret_uae_usd" class="calculated-field bg-gray-100 text-sm">...</span><span id="cost_fret_uae_eur" class="calculated-field bg-gray-100 text-sm">...</span></div></li>
                       <li class="grid grid-cols-2 gap-4 items-center"><span>Taxes & Douanes EAU</span><div class="grid grid-cols-3 gap-2"><span id="cost_douane_uae" contenteditable="true" class="input-field" onkeyup="calculateAll()">30</span><span id="cost_douane_uae_usd" class="calculated-field bg-gray-100 text-sm">...</span><span id="cost_douane_uae_eur" class="calculated-field bg-gray-100 text-sm">...</span></div></li>
                       <li class="grid grid-cols-2 gap-4 items-center"><span>Stockage EAU</span><div class="grid grid-cols-3 gap-2"><span id="cost_stock_uae" contenteditable="true" class="input-field" onkeyup="calculateAll()">73</span><span id="cost_stock_uae_usd" class="calculated-field bg-gray-100 text-sm">...</span><span id="cost_stock_uae_eur" class="calculated-field bg-gray-100 text-sm">...</span></div></li>
                       <li class="grid grid-cols-2 gap-4 items-center"><span>Expédition client EAU</span><div class="grid grid-cols-3 gap-2"><span id="cost_ship_uae" contenteditable="true" class="input-field" onkeyup="calculateAll()">55</span><span id="cost_ship_uae_usd" class="calculated-field bg-gray-100 text-sm">...</span><span id="cost_ship_uae_eur" class="calculated-field bg-gray-100 text-sm">...</span></div></li>
                    </ul>
                     <div class="bg-green-200 p-4 rounded-lg text-center">
                        <p class="text-sm font-bold text-green-900">PRIX DE REVIENT EAU</p>
                        <span id="final_cost_uae" class="text-3xl font-bold text-green-900">...</span><span class="text-green-900 font-semibold"> AED</span>
                        <div class="text-sm text-green-800">
                            <p id="final_cost_uae_usd">... USD</p>
                            <p id="final_cost_uae_eur">... EUR</p>
                        </div>
                    </div>
                </div>
                
                <!-- SCENARIO US -->
                <div class="bg-purple-50 border border-purple-200 p-6 rounded-lg">
                    <h3 class="font-bold text-xl mb-4 text-purple-800 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>
                        Scénario 3 : Vente aux US
                    </h3>
                    <h4 class="font-semibold mb-2 text-gray-700">E. Coûts Logistiques (par pièce)</h4>
                    <div class="grid grid-cols-2 gap-4 text-right pr-1 mb-1 text-sm font-semibold text-gray-500">
                        <span></span>
                        <div class="grid grid-cols-3 gap-2">
                            <span>AED (Base)</span>
                            <span>USD</span>
                            <span>EUR</span>
                        </div>
                    </div>
                    <ul class="space-y-3 text-sm text-gray-800 mb-6">
                       <li class="grid grid-cols-2 gap-4 items-center"><span>Fret sécurisé FR -> US</span><div class="grid grid-cols-3 gap-2"><span id="cost_fret_us" contenteditable="true" class="input-field" onkeyup="calculateAll()">130</span><span id="cost_fret_us_usd" class="calculated-field bg-gray-100 text-sm">...</span><span id="cost_fret_us_eur" class="calculated-field bg-gray-100 text-sm">...</span></div></li>
                       <li class="grid grid-cols-2 gap-4 items-center"><span>Taxes & Douanes US</span><div class="grid grid-cols-3 gap-2"><span id="cost_douane_us" contenteditable="true" class="input-field" onkeyup="calculateAll()">45</span><span id="cost_douane_us_usd" class="calculated-field bg-gray-100 text-sm">...</span><span id="cost_douane_us_eur" class="calculated-field bg-gray-100 text-sm">...</span></div></li>
                       <li class="grid grid-cols-2 gap-4 items-center"><span>Stockage US</span><div class="grid grid-cols-3 gap-2"><span id="cost_stock_us" contenteditable="true" class="input-field" onkeyup="calculateAll()">85</span><span id="cost_stock_us_usd" class="calculated-field bg-gray-100 text-sm">...</span><span id="cost_stock_us_eur" class="calculated-field bg-gray-100 text-sm">...</span></div></li>
                       <li class="grid grid-cols-2 gap-4 items-center"><span>Expédition client US</span><div class="grid grid-cols-3 gap-2"><span id="cost_ship_us" contenteditable="true" class="input-field" onkeyup="calculateAll()">65</span><span id="cost_ship_us_usd" class="calculated-field bg-gray-100 text-sm">...</span><span id="cost_ship_us_eur" class="calculated-field bg-gray-100 text-sm">...</span></div></li>
                    </ul>
                     <div class="bg-purple-200 p-4 rounded-lg text-center">
                        <p class="text-sm font-bold text-purple-900">PRIX DE REVIENT US</p>
                        <span id="final_cost_us" class="text-3xl font-bold text-purple-900">...</span><span id="text-purple-900 font-semibold"> AED</span>
                        <div class="text-sm text-purple-800">
                            <p id="final_cost_us_usd">... USD</p>
                            <p id="final_cost_us_eur">... EUR</p>
                        </div>
                    </div>
                </div>
             </div>
        </div>
        
        <!-- === PARTIE 3: STRATEGIE DE PRIX ET MARGES === -->
        <div class="card mb-8">
             <h2 class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                Partie 3 : Stratégie de Prix & Marges
                <button onclick="saveData()" class="no-print ml-auto w-8 h-8 flex items-center justify-center rounded bg-slate-100 hover:bg-slate-200 transition-colors" title="Sauvegarder les données">
                    <svg class="w-5 h-5 text-slate-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                </button>
            </h2>
            <div class="info-box">
                <h4 class="font-bold text-gray-800">Définissez vos coefficients de vente par marché</h4>
                <p class="text-sm text-gray-600">Ces coefficients s'appliquent à toutes les gammes. Utilisez les listes pour choisir une valeur standard ou entrez une valeur personnalisée.</p>
            </div>
            
            <div id="market-coeffs-container" class="space-y-6">
                <!-- Les coefficients par marché seront injectés ici -->
            </div>


            <!-- Resultats -->
            <div class="mt-12">
                <h3 class="text-xl font-bold text-center text-gray-700 mb-6">Résultats pour la gamme sélectionnée : <span id="current-range-name" class="text-blue-600">...</span></h3>
                <div class="grid lg:grid-cols-3 gap-8">
                    <!-- Resultats Europe -->
                    <div class="space-y-6">
                         <h3 class="font-bold text-xl text-blue-800 text-center py-2 bg-blue-100 rounded-lg">Résultats Scénario EUROPE (EUR)</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4 text-center">
                             <div class="p-4 bg-slate-50 rounded-lg">
                                <p class="font-bold">Revendeurs</p>
                                <p id="prix_vente_revendeur_eu" class="text-xl font-bold text-blue-700 my-2">...</p>
                                <p><span id="marge_valeur_revendeur_eu" class="tag bg-blue-200 text-blue-800">...</span></p>
                                <p><span id="marge_pct_revendeur_eu" class="text-sm text-gray-600">...</span></p>
                            </div>
                             <div class="p-4 bg-slate-50 rounded-lg">
                                <p class="font-bold">Client Final (DTC)</p>
                                <p id="prix_vente_client_eu" class="text-xl font-bold text-blue-700 my-2">...</p>
                                <p><span id="marge_valeur_client_eu" class="tag bg-blue-200 text-blue-800">...</span></p>
                                <p><span id="marge_pct_client_eu" class="text-sm text-gray-600">...</span></p>
                            </div>
                        </div>
                    </div>
                     <!-- Resultats EAU -->
                    <div class="space-y-6">
                         <h3 class="font-bold text-xl text-green-800 text-center py-2 bg-green-100 rounded-lg">Résultats Scénario EAU (AED)</h3>
                         <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4 text-center">
                             <div class="p-4 bg-slate-50 rounded-lg">
                                <p class="font-bold">Revendeurs</p>
                                <p id="prix_vente_revendeur_uae" class="text-xl font-bold text-green-700 my-2">...</p>
                                <p><span id="marge_valeur_revendeur_uae" class="tag bg-green-200 text-green-800">...</span></p>
                                <p><span id="marge_pct_revendeur_uae" class="text-sm text-gray-600">...</span></p>
                            </div>
                             <div class="p-4 bg-slate-50 rounded-lg">
                                <p class="font-bold">Client Final (DTC)</p>
                                <p id="prix_vente_client_uae" class="text-xl font-bold text-green-700 my-2">...</p>
                                <p><span id="marge_valeur_client_uae" class="tag bg-green-200 text-green-800">...</span></p>
                                <p><span id="marge_pct_client_uae" class="text-sm text-gray-600">...</span></p>
                            </div>
                        </div>
                    </div>
                    <!-- Resultats US -->
                    <div class="space-y-6">
                         <h3 class="font-bold text-xl text-purple-800 text-center py-2 bg-purple-100 rounded-lg">Résultats Scénario US (USD)</h3>
                         <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4 text-center">
                             <div class="p-4 bg-slate-50 rounded-lg">
                                <p class="font-bold">Revendeurs</p>
                                <p id="prix_vente_revendeur_us" class="text-xl font-bold text-purple-700 my-2">...</p>
                                <p><span id="marge_valeur_revendeur_us" class="tag bg-purple-200 text-purple-800">...</span></p>
                                <p><span id="marge_pct_revendeur_us" class="text-sm text-gray-600">...</span></p>
                            </div>
                             <div class="p-4 bg-slate-50 rounded-lg">
                                <p class="font-bold">Client Final (DTC)</p>
                                <p id="prix_vente_client_us" class="text-xl font-bold text-purple-700 my-2">...</p>
                                <p><span id="marge_valeur_client_us" class="tag bg-purple-200 text-purple-800">...</span></p>
                                <p><span id="marge_pct_client_us" class="text-sm text-gray-600">...</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- === PARTIE 4: VOLUME DE PRODUCTION === -->
        <div class="card mb-8">
            <h2 class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>
                Partie 4 : Volume de Production Annuel
                <button onclick="saveData()" class="no-print ml-auto w-8 h-8 flex items-center justify-center rounded bg-slate-100 hover:bg-slate-200 transition-colors" title="Sauvegarder les données">
                    <svg class="w-5 h-5 text-slate-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                </button>
            </h2>
            <div>
                <label class="block text-lg font-semibold text-gray-700">Volume par Gamme</label>
                <p class="text-sm text-gray-500 mb-2">Nombre de pièces produites par an pour chaque gamme. Ce total sert à calculer le coût indirect par pièce.</p>
                <div id="volume-inputs-container" class="space-y-2 bg-slate-50 p-3 rounded-md">
                    <!-- Les champs de volume seront injectés ici par le script -->
                </div>
                <div class="mt-3 text-right font-bold text-gray-700">
                    Volume Total Annuel : <span id="total-volume-display" class="text-lg text-blue-600">...</span> pièces
                </div>
            </div>
        </div>

        <!-- === PARTIE 5: ANALYSE DU SEUIL DE RENTABILITÉ === -->
        <div class="card">
            <h2 class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M18.7 8a6 6 0 0 0-8.4-5.2C7.3 3.4 4.3 6.4 3 9.8"/><path d="M12 12a4 4 0 0 0 4-4"/></svg>
                Partie 5 : Seuil de Rentabilité
                <button onclick="saveData()" class="no-print ml-auto w-8 h-8 flex items-center justify-center rounded bg-slate-100 hover:bg-slate-200 transition-colors" title="Sauvegarder les données">
                    <svg class="w-5 h-5 text-slate-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                </button>
            </h2>
            <div class="info-box">
                <h4 class="font-bold text-gray-800">Qu'est-ce que le "point mort" ?</h4>
                <p class="text-sm text-gray-600">
                    Le point mort est le <strong>nombre exact de sacs que vous devez vendre pour que la somme de vos bénéfices rembourse entièrement vos charges annuelles</strong>. Le calcul se base sur les coefficients du marché EAU.
                </p>
            </div>
            <div class="grid md:grid-cols-2 gap-x-8 gap-y-12 items-start">
                <!-- Step 1 -->
                <div>
                    <h3 class="font-semibold text-lg mb-3 text-slate-800">Étape 1 : Comment vendez-vous vos produits ?</h3>
                    <p class="text-sm text-gray-600 mb-4">Indiquez la répartition de vos ventes (la somme doit faire 100%).</p>
                    <div class="space-y-3">
                        <div>
                            <label>% Ventes via Revendeurs</label>
                            <input id="dist_retail" type="number" value="70" class="w-full mt-1 p-2 border rounded-md" onkeyup="calculateAll()">
                        </div>
                        <div>
                            <label>% Ventes Directes (DTC)</label>
                            <input id="dist_direct" type="number" value="30" class="w-full mt-1 p-2 border rounded-md" onkeyup="calculateAll()">
                        </div>
                        <div id="dist_total_feedback" class="text-center font-semibold pt-2"></div>
                    </div>
                </div>
                <!-- Step 2 -->
                <div>
                     <h3 class="font-semibold text-lg mb-3 text-slate-800">Étape 2 : Le calcul de votre rentabilité</h3>
                     <div class="bg-slate-50 p-6 rounded-lg space-y-4">
                        <div>
                            <div class="flex justify-between items-center">
                                <p class="text-sm text-gray-600">Total des charges annuelles à couvrir :</p>
                                <button onclick="toggleDetails('bep_annual_costs_details')" class="text-xs text-blue-600 hover:underline no-print">(voir le détail)</button>
                            </div>
                            <p id="bep_total_annual" class="text-xl font-bold text-red-600">... AED</p>
                            <div id="bep_annual_costs_details" class="hidden mt-2 text-xs text-gray-500 border-t pt-2 space-y-1">
                                <!-- Details will be injected here by the script -->
                            </div>
                        </div>
                        <div class="border-t my-2"></div>
                        <div>
                            <p class="text-sm text-gray-600">Votre bénéfice moyen par sac vendu :</p>
                            <p id="avg_margin_unit" class="text-xl font-bold text-green-600">... AED</p>
                        </div>
                        <div class="bg-yellow-100 border border-yellow-300 text-yellow-800 p-4 rounded-lg text-center mt-4">
                            <p class="text-sm font-bold uppercase">Objectif de Ventes pour être rentable :</p>
                            <p id="break_even_point" class="text-4xl font-bold">...</p>
                        </div>
                     </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Price List Modal -->
    <div id="price-list-modal" class="modal-overlay hidden no-print">
        <div class="modal-container">
            <div id="price-list-printable">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800">Liste de Prix - Revendeurs</h2>
                        <p class="text-gray-500" id="price-list-date">Valable à partir du ...</p>
                    </div>
                    <button onclick="closePriceListModal()" class="text-gray-500 hover:text-gray-800 no-print text-3xl">&times;</button>
                </div>
                <div id="price-list-content" class="space-y-8">
                    <!-- Dynamic content will be injected here -->
                </div>
            </div>
            <div class="text-right mt-6 no-print">
                <button onclick="printPriceList()" class="bg-slate-800 text-white font-semibold py-2 px-5 rounded-lg hover:bg-slate-700 transition duration-300">Imprimer la Liste</button>
                <button onclick="closePriceListModal()" class="bg-gray-200 text-gray-800 font-semibold py-2 px-5 rounded-lg hover:bg-gray-300 transition duration-300 ml-2">Fermer</button>
            </div>
        </div>
    </div>


    <script>
        // --- DATA MODELS ---
        let productData = {
            "Essential Sparkle": { matieres: 215, couturier: 225, artiste_heures: 70, artiste_taux: 50, packaging: 300, volume: 20 },
            "Luminous Luxe":     { matieres: 276, couturier: 259, artiste_heures: 90, artiste_taux: 50, packaging: 312, volume: 20 },
            "Signature Shine":   { matieres: 330, couturier: 312, artiste_heures: 110, artiste_taux: 50, packaging: 332, volume: 25 },
            "Crystal Dream":     { matieres: 442, couturier: 367, artiste_heures: 130, artiste_taux: 50, packaging: 404, volume: 15 },
            "Couture Embroidery":{ matieres: 551, couturier: 480, artiste_heures: 150, artiste_taux: 50, packaging: 459, volume: 20 },
        };

        let marketCoefficients = {
            eu:  { name: "Europe (EUR)", retailer: 2.5, pvc: 5.0 },
            uae: { name: "EAU (AED)", retailer: 2.5, pvc: 6.0 },
            us:  { name: "États-Unis (USD)", retailer: 2.5, pvc: 5.5 }
        };

        const coeffRanges = {
            retailer: {
                eu:  [2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8],
                uae: [2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8],
                us:  [2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8]
            },
            pvc: {
                eu:  [4.0, 4.5, 5.0, 5.5, 6.0, 6.5],
                uae: [5.0, 5.5, 6.0, 6.5, 7.0, 7.5, 8.0],
                us:  [4.5, 5.0, 5.5, 6.0, 6.5, 7.0]
            }
        };
        
        const contentEditableFields = [
            'cost_atelier', 'cost_amort', 'cost_salaires', 'cost_marketing', 'cost_ecommerce', 'cost_domain', 'cost_license_visa', 'cost_frais',
            'cost_stock_fr', 'cost_ship_eu',
            'cost_fret_uae', 'cost_douane_uae', 'cost_stock_uae', 'cost_ship_uae',
            'cost_fret_us', 'cost_douane_us', 'cost_stock_us', 'cost_ship_us'
        ];

        const inputFields = [
            'rate_usd_aed', 'rate_eur_aed',
            'dist_retail', 'dist_direct'
        ];
        
        // --- UTILITY FUNCTIONS ---
        function getVal(id) {
            const element = document.getElementById(id);
            if (!element) return 0;
            const value = element.tagName.toLowerCase() === 'input' || element.tagName.toLowerCase() === 'select' ? element.value : element.innerText;
            return parseFloat(value.replace(/,/g, '.')) || 0;
        }
        
        function getRawVal(id) {
            const element = document.getElementById(id);
            if (!element) return '';
            return element.tagName.toLowerCase() === 'input' || element.tagName.toLowerCase() === 'select' ? element.value : element.innerText;
        }
        
        function setVal(id, value, format, currency = 'AED') {
            const element = document.getElementById(id);
            if (!element) return;

            let formattedValue = '';
            if (format === 'currency') {
                let symbol = '';
                if (currency === 'AED') symbol = 'AED';
                else if (currency === 'EUR') symbol = '€';
                else if (currency === 'USD') symbol = '$';
                formattedValue = `${value.toFixed(2)} ${symbol}`;
            } else if (format === 'currency_only') {
                 formattedValue = value.toFixed(2);
            } else if (format === 'percent') {
                 formattedValue = `Marge: ${value.toFixed(1)} %`;
            } else if (format === 'units') {
                formattedValue = `${Math.ceil(value)} unités`;
            }
             else {
                formattedValue = value;
            }
            
            if (element.tagName.toLowerCase() === 'input' || element.tagName.toLowerCase() === 'select') {
                element.value = value;
            } else {
                element.innerText = formattedValue;
            }
        }

        function showNotification(message, duration = 2000) {
            const notification = document.getElementById('notification');
            notification.innerText = message;
            notification.classList.remove('opacity-0');
            setTimeout(() => {
                notification.classList.add('opacity-0');
            }, duration);
        }

        // --- DATA & STATE MANAGEMENT ---
        async function saveData() {
            if (!isFirebaseConfigured) {
                showNotification("Veuillez configurer Firebase pour la sauvegarde en ligne.", 3000);
                return;
            }

            const dataToSave = {
                productData: productData,
                marketCoefficients: marketCoefficients,
                contentEditableData: {},
                inputData: {},
                selectedRange: document.getElementById('product_range').value
            };
            contentEditableFields.forEach(id => {
                dataToSave.contentEditableData[id] = getVal(id);
            });
            inputFields.forEach(id => {
                dataToSave.inputData[id] = getVal(id);
            });

            try {
                await db.collection("calculator").doc("calculatorState").set(dataToSave);
                showNotification('Données sauvegardées en ligne !');
            } catch (error) {
                console.error("Erreur de sauvegarde sur Firebase:", error);
                showNotification('Erreur de sauvegarde en ligne.', 3000);
            }
        }
        
        // --- REAL-TIME LISTENER ---
        function setupRealtimeListener() {
            if (!isFirebaseConfigured) {
                console.log("Firebase non configuré. Le mode temps réel est désactivé.");
                return;
            }

            db.collection("calculator").doc("calculatorState").onSnapshot((doc) => {
                if (doc.exists) {
                    console.log("Données reçues en temps réel.");
                    const parsedData = doc.data();
                    
                    if (parsedData.productData) {
                        for (const range in parsedData.productData) {
                            if (parsedData.productData[range].hasOwnProperty('coeff_retailer')) delete parsedData.productData[range].coeff_retailer;
                            if (parsedData.productData[range].hasOwnProperty('coeff_pvc')) delete parsedData.productData[range].coeff_pvc;

                            if (parsedData.productData[range].hasOwnProperty('artiste') && !parsedData.productData[range].hasOwnProperty('artiste_heures')) {
                                const totalArtisteCost = parsedData.productData[range].artiste;
                                const defaultRate = 50;
                                parsedData.productData[range].artiste_taux = defaultRate;
                                parsedData.productData[range].artiste_heures = totalArtisteCost > 0 ? totalArtisteCost / defaultRate : 70;
                                delete parsedData.productData[range].artiste;
                            }
                        }
                        productData = parsedData.productData;
                    }

                    if (parsedData.marketCoefficients) {
                        marketCoefficients = parsedData.marketCoefficients;
                    }
                    
                    if (parsedData.contentEditableData) {
                        contentEditableFields.forEach(id => {
                            const el = document.getElementById(id);
                            if (el && parsedData.contentEditableData[id] !== undefined) {
                                el.innerText = parsedData.contentEditableData[id];
                            }
                        });
                    }
                    
                    if (parsedData.inputData) {
                        inputFields.forEach(id => {
                            const element = document.getElementById(id);
                            if (element && parsedData.inputData[id] !== undefined) {
                                element.value = parsedData.inputData[id];
                            }
                        });
                    }

                    const selector = document.getElementById('product_range');
                    if (parsedData.selectedRange && Array.from(selector.options).some(opt => opt.value === parsedData.selectedRange)) {
                       if (selector.value !== parsedData.selectedRange) {
                           selector.value = parsedData.selectedRange;
                       }
                    }

                    // Re-render UI with new data
                    renderVolumeInputs();
                    renderMarketCoefficients();
                    updateDirectCosts(); // This will trigger calculateAll

                } else {
                    console.log("Aucun document de sauvegarde trouvé en ligne.");
                }
            }, (error) => {
                console.error("Erreur avec l'écouteur temps réel:", error);
            });
        }


        // --- INITIALIZATION & UI RENDERING ---
        async function initCalculator() {
            if (!isFirebaseConfigured) {
                document.getElementById('firebase-warning').classList.remove('hidden');
            }
            populateRangeSelector();
            await fetchExchangeRates(); 
            setupRealtimeListener(); // This will load data and listen for changes
        }

        async function fetchExchangeRates() {
            const statusEl = document.getElementById('exchange-rate-status');
            if (statusEl) {
                statusEl.innerText = '(Mise à jour...)';
                statusEl.classList.remove('text-green-400', 'text-red-400');
            }

            try {
                const response = await fetch('https://open.er-api.com/v6/latest/AED');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                const rateAEDtoUSD = data.rates.USD;
                const rateAEDtoEUR = data.rates.EUR;

                if (rateAEDtoUSD > 0) {
                    document.getElementById('rate_usd_aed').value = (1 / rateAEDtoUSD).toFixed(3);
                }
                if (rateAEDtoEUR > 0) {
                    document.getElementById('rate_eur_aed').value = (1 / rateAEDtoEUR).toFixed(3);
                }
                
                if (statusEl) {
                    const updateDate = new Date(data.time_last_update_utc).toLocaleDateString('fr-FR');
                    statusEl.innerText = `(Taux du ${updateDate})`;
                    statusEl.classList.add('text-green-400');
                }
                
                calculateAll();

            } catch (error) {
                console.error('Failed to fetch exchange rates:', error);
                if (statusEl) {
                    statusEl.innerText = '(Erreur de mise à jour)';
                    statusEl.classList.add('text-red-400');
                }
            }
        }

        function populateRangeSelector() {
            const selector = document.getElementById('product_range');
            let html = '';
            for (const rangeName in productData) {
                html += `<option>${rangeName}</option>`;
            }
            selector.innerHTML = html;
        }

        function renderVolumeInputs() {
            const container = document.getElementById('volume-inputs-container');
            let html = '';
            for (const rangeName in productData) {
                html += `
                    <div class="grid grid-cols-2 items-center gap-2">
                        <label for="volume_${rangeName.replace(/\s+/g, '')}" class="text-sm text-gray-600">${rangeName}</label>
                        <input type="number" id="volume_${rangeName.replace(/\s+/g, '')}"
                               value="${productData[rangeName].volume}"
                               class="w-full p-1 border border-gray-300 rounded-md text-right"
                               onkeyup="updateAndCalculateVolume('${rangeName}')">
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        function renderMarketCoefficients() {
            const container = document.getElementById('market-coeffs-container');
            let html = '';

            for (const marketKey in marketCoefficients) {
                const market = marketCoefficients[marketKey];
                html += `
                <div class="bg-slate-100 p-4 rounded-lg">
                    <h4 class="font-semibold text-lg mb-4 text-center">${market.name}</h4>
                    <div class="grid md:grid-cols-2 gap-6">
                        ${createCoeffInput(marketKey, 'retailer')}
                        ${createCoeffInput(marketKey, 'pvc')}
                    </div>
                </div>
                `;
            }
            container.innerHTML = html;
            
            for (const marketKey in marketCoefficients) {
                setCoeffValue(marketKey, 'retailer', marketCoefficients[marketKey].retailer);
                setCoeffValue(marketKey, 'pvc', marketCoefficients[marketKey].pvc);
            }
        }

        function createCoeffInput(market, type) {
            const label = type === 'retailer' ? 'Coefficient Revendeur' : 'Coefficient Vente Directe (DTC)';
            const range = coeffRanges[type][market];
            let options = range.map(val => `<option value="${val}">x ${val.toFixed(1)}</option>`).join('');
            options += '<option value="custom">Personnalisé...</option>';

            return `
                <div class="text-center">
                    <label class="font-semibold text-sm">${label}</label>
                    <div class="flex items-center gap-2 mt-1">
                        <select id="select_${market}_${type}" class="w-full p-2 border rounded-md" onchange="handleCoeffSelectChange('${market}', '${type}')">
                            ${options}
                        </select>
                        <input type="number" id="input_${market}_${type}" class="w-24 p-2 border rounded-md hidden text-center" step="0.1" onkeyup="handleCoeffInputChange('${market}', '${type}')">
                    </div>
                </div>
            `;
        }

        // --- EVENT HANDLERS & UI UPDATERS ---
        function updateAndCalculateVolume(rangeName) {
            const value = getVal(`volume_${rangeName.replace(/\s+/g, '')}`);
            if (productData[rangeName]) {
                productData[rangeName].volume = value;
            }
            calculateAll();
        }

        function handleCoeffSelectChange(market, type) {
            const selectEl = document.getElementById(`select_${market}_${type}`);
            const inputEl = document.getElementById(`input_${market}_${type}`);
            if (selectEl.value === 'custom') {
                inputEl.classList.remove('hidden');
                inputEl.value = marketCoefficients[market][type];
                inputEl.focus();
            } else {
                inputEl.classList.add('hidden');
                marketCoefficients[market][type] = parseFloat(selectEl.value);
                calculateAll();
            }
        }

        function handleCoeffInputChange(market, type) {
            const inputEl = document.getElementById(`input_${market}_${type}`);
            marketCoefficients[market][type] = parseFloat(inputEl.value) || 0;
            calculateAll();
        }

        function setCoeffValue(market, type, value) {
            const selectEl = document.getElementById(`select_${market}_${type}`);
            const inputEl = document.getElementById(`input_${market}_${type}`);
            
            const range = coeffRanges[type][market];
            if (range.includes(value)) {
                selectEl.value = value;
                inputEl.classList.add('hidden');
            } else {
                selectEl.value = 'custom';
                inputEl.value = value;
                inputEl.classList.remove('hidden');
            }
        }
        
        function convertCurrency(source) {
            const rateUSD = getVal('rate_usd_aed');
            const rateEUR = getVal('rate_eur_aed');
            let aedValue = 0;

            if (source === 'aed') aedValue = getVal('conv_aed');
            else if (source === 'usd') aedValue = getVal('conv_usd') * rateUSD;
            else if (source === 'eur') aedValue = getVal('conv_eur') * rateEUR;
            
            if(getRawVal('conv_'+source) === '') {
                 document.getElementById('conv_aed').value = '';
                 document.getElementById('conv_usd').value = '';
                 document.getElementById('conv_eur').value = '';
                 return;
            }
            
            if (source !== 'aed') document.getElementById('conv_aed').value = aedValue > 0 ? aedValue.toFixed(2) : '';
            if (source !== 'usd') document.getElementById('conv_usd').value = aedValue > 0 ? (aedValue / rateUSD).toFixed(2) : '';
            if (source !== 'eur') document.getElementById('conv_eur').value = aedValue > 0 ? (aedValue / rateEUR).toFixed(2) : '';
        }

        function updateDirectCosts() {
            const selectedRange = document.getElementById('product_range').value;
            const costs = productData[selectedRange];

            if (costs) {
                document.getElementById('cost_matieres').innerText = costs.matieres.toFixed(2);
                document.getElementById('cost_couturier').innerText = costs.couturier.toFixed(2);
                document.getElementById('cost_packaging').innerText = costs.packaging.toFixed(2);
                
                setVal('cost_artiste_heures', costs.artiste_heures);
                setVal('cost_artiste_taux', costs.artiste_taux);

                document.getElementById('current-range-name').innerText = selectedRange;
            }
            updateAndCalculateArtistCost(false);
            calculateAll();
        }
        
        function updateAndCalculate(costType) {
            const selectedRange = document.getElementById('product_range').value;
            const value = getVal(`cost_${costType}`);
            if (productData[selectedRange]) {
                productData[selectedRange][costType] = value;
            }
            calculateAll();
        }

        function updateAndCalculateArtistCost(triggerFullCalc = true) {
            const selectedRange = document.getElementById('product_range').value;
            if (!productData[selectedRange]) return;

            const heures = getVal('cost_artiste_heures');
            const taux = getVal('cost_artiste_taux');
            const total = heures * taux;

            productData[selectedRange].artiste_heures = heures;
            productData[selectedRange].artiste_taux = taux;

            document.getElementById('cost_artiste').innerText = total.toFixed(2);

            if (triggerFullCalc) {
                calculateAll();
            }
        }

        function toggleDetails(id) {
            const element = document.getElementById(id);
            if (element) {
                element.classList.toggle('hidden');
            }
        }

        // --- CORE CALCULATION LOGIC ---
        function calculateBreakEven(costPriceAED, coeffs) {
            const totalAnnualCosts = getVal('total_annual');
            setVal('bep_total_annual', totalAnnualCosts, 'currency');

            const detailsContainer = document.getElementById('bep_annual_costs_details');
            if (detailsContainer) {
                const indirectCosts = [
                    { name: 'Atelier/Loyer', value: getVal('cost_atelier') },
                    { name: 'Amortissement Matériel', value: getVal('cost_amort') },
                    { name: 'Salaires Admin/Vente', value: getVal('cost_salaires') },
                    { name: 'Marketing & Shooting', value: getVal('cost_marketing') },
                    { name: 'Sites E-commerce & Email', value: getVal('cost_ecommerce') },
                    { name: 'Nom de domaine', value: getVal('cost_domain') },
                    { name: 'Licence & Visa', value: getVal('cost_license_visa') },
                    { name: 'Frais (Bancaires, etc.)', value: getVal('cost_frais') }
                ];
                let detailsHtml = '';
                indirectCosts.forEach(cost => {
                    detailsHtml += `<div class="flex justify-between"><span>${cost.name}</span><span class="font-semibold">${cost.value.toFixed(2)} AED</span></div>`;
                });
                detailsContainer.innerHTML = detailsHtml;
            }
            
            const pctRetail = getVal('dist_retail') / 100;
            const pctDirect = getVal('dist_direct') / 100;

            const totalPct = (pctRetail + pctDirect) * 100;
            const feedbackEl = document.getElementById('dist_total_feedback');
            feedbackEl.innerText = `Total : ${totalPct.toFixed(0)} %`;
            feedbackEl.classList.toggle('text-red-600', Math.round(totalPct) !== 100);
            feedbackEl.classList.toggle('text-green-600', Math.round(totalPct) === 100);

            const prixVenteClientAED = costPriceAED * coeffs.pvc;
            const prixVenteRevendeurAED = prixVenteClientAED / coeffs.retailer;
            
            const margeValeurRevendeurAED = prixVenteRevendeurAED - costPriceAED;
            const margeValeurClientAED = prixVenteClientAED - costPriceAED;
            
            const weightedAvgMargin = (margeValeurRevendeurAED * pctRetail) + (margeValeurClientAED * pctDirect);
            
            setVal('avg_margin_unit', weightedAvgMargin, 'currency');

            if (weightedAvgMargin > 0) {
                const breakEvenPoint = totalAnnualCosts / weightedAvgMargin;
                setVal('break_even_point', breakEvenPoint, 'units');
            } else {
                document.getElementById('break_even_point').innerText = 'Marge Nulle ou Négative';
            }
        }

        function calculateAll() {
            const rateUSD = getVal('rate_usd_aed') || 1;
            const rateEUR = getVal('rate_eur_aed') || 1;
            
            const updateCurrencies = (id, aedValue) => {
                const el_usd = document.getElementById(`${id}_usd`);
                const el_eur = document.getElementById(`${id}_eur`);
                if(el_usd) el_usd.innerText = (aedValue / rateUSD).toFixed(2);
                if(el_eur) el_eur.innerText = (aedValue / rateEUR).toFixed(2);
            };
            
            // 1. Calculate Direct Costs for selected range
            const cost_matieres = getVal('cost_matieres'); updateCurrencies('cost_matieres', cost_matieres);
            const cost_couturier = getVal('cost_couturier'); updateCurrencies('cost_couturier', cost_couturier);
            const cost_artiste = getVal('cost_artiste'); updateCurrencies('cost_artiste', cost_artiste);
            const cost_packaging = getVal('cost_packaging'); updateCurrencies('cost_packaging', cost_packaging);
            const totalDirects = cost_matieres + cost_couturier + cost_artiste + cost_packaging;
            document.getElementById('total_directs').innerText = totalDirects.toFixed(2);
            updateCurrencies('total_directs', totalDirects);

            // 2. Calculate Annual and Per-Unit Indirect Costs
            const totalAnnual = contentEditableFields.slice(0, 8).reduce((sum, id) => sum + getVal(id), 0);
            document.getElementById('total_annual').innerText = totalAnnual.toFixed(2);
            updateCurrencies('total_annual', totalAnnual);
            
            let totalUnits = 0;
            for (const rangeName in productData) {
                totalUnits += productData[rangeName].volume || 0;
            }
            if (totalUnits === 0) totalUnits = 1;
            document.getElementById('total-volume-display').innerText = Math.round(totalUnits);
            
            const indirectPerUnit = totalAnnual / totalUnits;
            setVal('indirect_per_unit', indirectPerUnit, 'currency');
            setVal('indirect_per_unit_usd', indirectPerUnit / rateUSD, 'currency', 'USD');
            setVal('indirect_per_unit_eur', indirectPerUnit / rateEUR, 'currency', 'EUR');

            // 3. Calculate Final Cost Price per Scenario
            const cost_stock_fr = getVal('cost_stock_fr'); updateCurrencies('cost_stock_fr', cost_stock_fr);
            const cost_ship_eu = getVal('cost_ship_eu'); updateCurrencies('cost_ship_eu', cost_ship_eu);
            const logistiqueEU = cost_stock_fr + cost_ship_eu;
            const finalCostEU = totalDirects + indirectPerUnit + logistiqueEU;
            setVal('final_cost_eu', finalCostEU, 'currency');
            setVal('final_cost_eu_usd', finalCostEU / rateUSD, 'currency', 'USD');
            setVal('final_cost_eu_eur', finalCostEU / rateEUR, 'currency', 'EUR');

            const cost_fret_uae = getVal('cost_fret_uae'); updateCurrencies('cost_fret_uae', cost_fret_uae);
            const cost_douane_uae = getVal('cost_douane_uae'); updateCurrencies('cost_douane_uae', cost_douane_uae);
            const cost_stock_uae = getVal('cost_stock_uae'); updateCurrencies('cost_stock_uae', cost_stock_uae);
            const cost_ship_uae = getVal('cost_ship_uae'); updateCurrencies('cost_ship_uae', cost_ship_uae);
            const logistiqueUAE = cost_fret_uae + cost_douane_uae + cost_stock_uae + cost_ship_uae;
            const finalCostUAE = totalDirects + indirectPerUnit + logistiqueUAE;
            setVal('final_cost_uae', finalCostUAE, 'currency');
            setVal('final_cost_uae_usd', finalCostUAE / rateUSD, 'currency', 'USD');
            setVal('final_cost_uae_eur', finalCostUAE / rateEUR, 'currency', 'EUR');

            const cost_fret_us = getVal('cost_fret_us'); updateCurrencies('cost_fret_us', cost_fret_us);
            const cost_douane_us = getVal('cost_douane_us'); updateCurrencies('cost_douane_us', cost_douane_us);
            const cost_stock_us = getVal('cost_stock_us'); updateCurrencies('cost_stock_us', cost_stock_us);
            const cost_ship_us = getVal('cost_ship_us'); updateCurrencies('cost_ship_us', cost_ship_us);
            const logistiqueUS = cost_fret_us + cost_douane_us + cost_stock_us + cost_ship_us;
            const finalCostUS = totalDirects + indirectPerUnit + logistiqueUS;
            setVal('final_cost_us', finalCostUS, 'currency');
            setVal('final_cost_us_usd', finalCostUS / rateUSD, 'currency', 'USD');
            setVal('final_cost_us_eur', finalCostUS / rateEUR, 'currency', 'EUR');

            // 4. Calculate Margins and Prices based on Market Coeffs
            calculateAndSetMargins('eu', finalCostEU, marketCoefficients.eu);
            calculateAndSetMargins('uae', finalCostUAE, marketCoefficients.uae);
            calculateAndSetMargins('us', finalCostUS, marketCoefficients.us);
            
            // 5. Calculate Break-Even Point (using UAE market as reference)
            calculateBreakEven(finalCostUAE, marketCoefficients.uae);
        }

        function calculateAndSetMargins(region, costPriceAED, coeffs) {
            let currency = 'AED';
            let rate = 1;
            const rateEUR = getVal('rate_eur_aed') || 1;
            const rateUSD = getVal('rate_usd_aed') || 1;

            if (region === 'eu') { currency = 'EUR'; rate = rateEUR; } 
            else if (region === 'us') { currency = 'USD'; rate = rateUSD; }

            const prixVenteClientAED = costPriceAED * coeffs.pvc;
            const margeValeurClientAED = prixVenteClientAED - costPriceAED;
            const margePctClient = (prixVenteClientAED > 0) ? (margeValeurClientAED / prixVenteClientAED) * 100 : 0;
            
            setVal(`prix_vente_client_${region}`, prixVenteClientAED / rate, 'currency', currency);
            setVal(`marge_valeur_client_${region}`, margeValeurClientAED / rate, 'currency', currency);
            setVal(`marge_pct_client_${region}`, margePctClient, 'percent');

            const prixVenteRevendeurAED = prixVenteClientAED / coeffs.retailer;
            const margeValeurRevendeurAED = prixVenteRevendeurAED - costPriceAED;
            const margePctRevendeur = (prixVenteRevendeurAED > 0) ? (margeValeurRevendeurAED / prixVenteRevendeurAED) * 100 : 0;

            setVal(`prix_vente_revendeur_${region}`, prixVenteRevendeurAED / rate, 'currency', currency);
            setVal(`marge_valeur_revendeur_${region}`, margeValeurRevendeurAED / rate, 'currency', currency);
            setVal(`marge_pct_revendeur_${region}`, margePctRevendeur, 'percent');
        }

        // --- Price List Modal Functions ---
        function openPriceListModal() {
            generatePriceList();
            document.getElementById('price-list-modal').classList.remove('hidden');
        }

        function closePriceListModal() {
            document.getElementById('price-list-modal').classList.add('hidden');
        }

        function printPriceList() {
            window.print();
        }

        function generatePriceList() {
            const contentDiv = document.getElementById('price-list-content');
            const date = new Date();
            date.setFullYear(date.getFullYear() + 1);
            document.getElementById('price-list-date').innerText = `Valable à partir du ${date.toLocaleDateString('fr-FR')}`;

            let html = '';

            const markets = [
                { id: 'uae', name: 'EAU (AED)', currency: 'AED', rate: 1, coeffs: marketCoefficients.uae, cost_log: () => getVal('cost_fret_uae') + getVal('cost_douane_uae') + getVal('cost_stock_uae') + getVal('cost_ship_uae') },
                { id: 'eu', name: 'Europe (€ EUR)', currency: 'EUR', rate: getVal('rate_eur_aed'), coeffs: marketCoefficients.eu, cost_log: () => getVal('cost_stock_fr') + getVal('cost_ship_eu') },
                { id: 'us', name: 'États-Unis ($ USD)', currency: 'USD', rate: getVal('rate_usd_aed'), coeffs: marketCoefficients.us, cost_log: () => getVal('cost_fret_us') + getVal('cost_douane_us') + getVal('cost_stock_us') + getVal('cost_ship_us') }
            ];

            let totalUnits = 0;
            for (const rangeName in productData) {
                totalUnits += productData[rangeName].volume || 0;
            }
            if (totalUnits === 0) totalUnits = 1;
            const indirectPerUnit = getVal('total_annual') / totalUnits;
            
            markets.forEach(market => {
                html += `<h3 class="text-2xl font-bold text-gray-700 mb-4">${market.name}</h3>`;
                html += `<div class="overflow-x-auto"><table class="w-full text-left border-collapse">`;
                html += `<thead><tr class="bg-slate-100"><th class="p-3 border-b-2 border-slate-200">Gamme de Produit</th><th class="p-3 border-b-2 border-slate-200 text-right">Prix de Vente Revendeur (${market.currency})</th><th class="p-3 border-b-2 border-slate-200 text-right">Prix Public Conseillé (${market.currency})</th></tr></thead><tbody>`;
                
                for (const rangeName in productData) {
                    const range = productData[rangeName];
                    const artisteCost = (range.artiste_heures || 0) * (range.artiste_taux || 0);
                    const directCosts = range.matieres + range.couturier + artisteCost + range.packaging;
                    const logisticCosts = market.cost_log();
                    const costPriceAED = directCosts + indirectPerUnit + logisticCosts;
                    
                    const prixVenteClientAED = costPriceAED * market.coeffs.pvc;
                    const prixVenteRevendeurAED = prixVenteClientAED / market.coeffs.retailer;
                    
                    const prixVenteRevendeur = (prixVenteRevendeurAED / market.rate).toFixed(2);
                    const prixVenteClient = (prixVenteClientAED / market.rate).toFixed(2);

                    html += `<tr class="hover:bg-slate-50"><td class="p-3 border-b border-slate-200 font-semibold">${rangeName}</td><td class="p-3 border-b border-slate-200 text-right">${prixVenteRevendeur}</td><td class="p-3 border-b border-slate-200 text-right">${prixVenteClient}</td></tr>`;
                }
                html += `</tbody></table></div>`;
            });
            contentDiv.innerHTML = html;
        }

    </script>
</body>
</html>

